Proyecto-IS2-Equipo-4

## Como iniciar
Primero es necesario que instalen npm con 
```bash
winget install Schniz.fnm
fnm install 22
node -v
```
Ahora si tienen problemas con permisos de windows
```bash
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
``` 
Luego deben clonar el repositorio desde github

para levantar el proyecto, deben ejecutar el comando y podran verlo en el navegador en el localhost
```bash
npm run dev
http://localhost:3000
```
en la carpeta en la que clonaron el repositorio.

En caso de que usemos Neon.tech ejecuten el siguiente comando 
```bash
npm i -g neonctl
```
Desde aquí comenzamos a trabajar :D


![image](https://github.com/user-attachments/assets/c159113b-5152-499d-8fcf-352248b42106)

```bash
CREATE TABLE "user" (
    "id" BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    "email" VARCHAR(255) UNIQUE NOT NULL,
    "password" VARCHAR(255) NOT NULL, 
    "username" VARCHAR(50) UNIQUE, 
    "default_latitude" DECIMAL(10, 8), 
    "default_longitude" DECIMAL(11, 8), 
    "created_at" TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    "updated_at" TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL
);


CREATE TABLE "activities" (
    "id" BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    "user_id" BIGINT, 
    "name" VARCHAR(100) NOT NULL,
    "description" TEXT,
    "icon_name" VARCHAR(50),
    "created_at" TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,

    CONSTRAINT fk_activities_user
        FOREIGN KEY("user_id")
        REFERENCES "user"("id")
        ON DELETE CASCADE, 

    UNIQUE ("name", "user_id")
);


CREATE TABLE "user_activity_preferences" (
    "preferences_id" BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    "user_id" BIGINT NOT NULL,
    "activity_id" BIGINT NOT NULL,
    "min_temp" SMALLINT, 
    "max_temp" SMALLINT,
    "max_wind_speed" SMALLINT, 
    "max_precipitation_probability" SMALLINT, 
    "max_precipitation_intensity" DECIMAL(4, 2), 
    "requires_no_precipitation" BOOLEAN DEFAULT FALSE NOT NULL, 
    "max_uv" SMALLINT, 
    "is_active" BOOLEAN DEFAULT TRUE NOT NULL, 
    "created_at" TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    "updated_at" TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,

    CONSTRAINT fk_preferences_user
        FOREIGN KEY("user_id")
        REFERENCES "user"("id")
        ON DELETE CASCADE,

    CONSTRAINT fk_preferences_activity
        FOREIGN KEY("activity_id")
        REFERENCES "activities"("id")
        ON DELETE CASCADE, 

    UNIQUE ("user_id", "activity_id")
);

CREATE TABLE "Agenda" (
    "id" BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    "user_id" BIGINT NOT NULL,
    "activity_id" BIGINT NOT NULL, 

    "periodicidad" INTEGER DEFAULT 0 NOT NULL, 
    "fecha" DATE NOT NULL, 
    "hora_inicio" TIME NOT NULL, 
    "hora_fin" TIME NOT NULL, 

    "notes" TEXT,
    "location_latitude" DECIMAL(10, 8), 
    "location_longitude" DECIMAL(11, 8),
    "reminder_enabled" BOOLEAN DEFAULT FALSE NOT NULL,
    "reminder_offset_minutes" INTEGER, 
    "created_at" TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    "updated_at" TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,

    CONSTRAINT fk_agenda_user
        FOREIGN KEY("user_id")
        REFERENCES "user"("id")
        ON DELETE CASCADE, 

    CONSTRAINT fk_agenda_activities
        FOREIGN KEY("activity_id")
        REFERENCES "activities"("id")
        ON DELETE CASCADE, 

    CHECK ("hora_fin" > "hora_inicio")
);


CREATE INDEX idx_preferences_user_id ON "user_activity_preferences" ("user_id");

CREATE INDEX idx_preferences_activity_id ON "user_activity_preferences" ("activity_id");

CREATE INDEX idx_agenda_user_id ON "Agenda" ("user_id");

CREATE INDEX idx_agenda_dia ON "Agenda" ("fecha");

CREATE INDEX idx_activities_creador_id ON "activities" ("user_id");
```

```bash
INSERT INTO "user" ("email", "password", "username", "default_latitude", "default_longitude") VALUES
('juan.perez@example.com', 'password123', 'juanp', 40.416775, -3.703790), 
('maria.garcia@example.com', 'securepass', 'mariag', 41.385063, 2.173404),  
('carlos.lopez@sample.net', 'pass1234', 'carlosl', 39.469907, -0.376288),  
('ana.martinez@domain.org', 'testpass', NULL, NULL, NULL); 


INSERT INTO "activities" ("user_id", "name", "description", "icon_name") VALUES
(1, 'Correr por el parque', 'Mi ruta habitual de 5km por el Retiro.', 'directions_run'),
(1, 'Leer libro técnico', 'Avanzar con el libro de patrones de diseño.', 'menu_book');


INSERT INTO "activities" ("user_id", "name", "description", "icon_name") VALUES
(2, 'Clase de Yoga', 'Sesión de Vinyasa Flow.', 'self_improvement'),
(2, 'Paseo por la playa', 'Caminata relajante por la Barceloneta.', 'surfing');


INSERT INTO "activities" ("user_id", "name", "description", "icon_name") VALUES
(NULL, 'Ir al gimnasio', 'Entrenamiento de fuerza o cardio.', 'fitness_center'),
(NULL, 'Hacer la compra', 'Comprar víveres para la semana.', 'shopping_cart');


INSERT INTO "user_activity_preferences" ("user_id", "activity_id", "min_temp", "max_temp", "max_wind_speed", "max_precipitation_probability", "requires_no_precipitation", "max_uv", "is_active") VALUES
(1, 1, 5, 22, 20, 20, TRUE, 7, TRUE);


INSERT INTO "user_activity_preferences" ("user_id", "activity_id", "is_active") VALUES
(1, 5, TRUE); 


INSERT INTO "user_activity_preferences" ("user_id", "activity_id", "min_temp", "max_temp", "max_wind_speed", "max_precipitation_probability", "max_precipitation_intensity", "requires_no_precipitation", "is_active") VALUES
(2, 4, 15, 30, 25, 15, 0.5, TRUE, TRUE);


INSERT INTO "user_activity_preferences" ("user_id", "activity_id", "is_active") VALUES
(2, 3, TRUE);


INSERT INTO "user_activity_preferences" ("user_id", "activity_id", "max_temp", "max_precipitation_probability", "is_active") VALUES
(3, 6, 35, 60, TRUE); 

INSERT INTO "user_activity_preferences" ("user_id", "activity_id", "is_active") VALUES
(1, 6, FALSE);


INSERT INTO "Agenda" ("user_id", "activity_id", "periodicidad", "fecha", "hora_inicio", "hora_fin", "notes", "location_latitude", "location_longitude", "reminder_enabled", "reminder_offset_minutes") VALUES
(1, 1, 0, CURRENT_DATE + INTERVAL '1 day', '07:00:00', '08:00:00', 'Intentar mejorar tiempo.', 40.4150, -3.6820, TRUE, 15); -- Cerca del Retiro


INSERT INTO "Agenda" ("user_id", "activity_id", "periodicidad", "fecha", "hora_inicio", "hora_fin", "notes") VALUES
(1, 2, 0, CURRENT_DATE, '21:00:00', '22:00:00', 'Capítulo 3: Singleton');


INSERT INTO "Agenda" ("user_id", "activity_id", "periodicidad", "fecha", "hora_inicio", "hora_fin", "notes", "reminder_enabled", "reminder_offset_minutes") VALUES
(2, 3, 0, CURRENT_DATE + INTERVAL '2 days', '19:00:00', '20:15:00', 'Llevar esterilla nueva.', TRUE, 30);


INSERT INTO "Agenda" ("user_id", "activity_id", "periodicidad", "fecha", "hora_inicio", "hora_fin", "location_latitude", "location_longitude") VALUES
(2, 6, 0, CURRENT_DATE, '17:30:00', '18:30:00', 41.3900, 2.1750); 


INSERT INTO "Agenda" ("user_id", "activity_id", "periodicidad", "fecha", "hora_inicio", "hora_fin", "notes") VALUES
(3, 5, 0, CURRENT_DATE + INTERVAL '1 day', '18:00:00', '19:30:00', 'Rutina de pecho y tríceps.');


INSERT INTO "Agenda" ("user_id", "activity_id", "periodicidad", "fecha", "hora_inicio", "hora_fin") VALUES
(4, 6, 0, date_trunc('week', CURRENT_DATE)::date + 5 + CASE WHEN date_part('isodow', CURRENT_DATE) > 5 THEN 7 ELSE 0 END, '10:00:00', '11:00:00'); -- Próximo Sábado a las 10:00


```
